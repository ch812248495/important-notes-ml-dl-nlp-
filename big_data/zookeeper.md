# zookeeper
分布式应用所设计的高可用, 高性能且一致的开源协调服务, 提供了一项基本服务: 分布式锁, 后来加入了配置维护, 组服务, 分布式消息队列, 分布式通知/协调等等

## 理解
- 对集群进行 master 选举, 解决分布式中的单点故障
- 分布式通常采用主从架构, 一个主控机连接多个处理节点, 主节点负责分发任务, 从节点负责处理任务, 主节点瘫痪后, 进行故障自动转移
    - hadoop: datanode 和 namenode
    - yarn: recoursemanager 和 nodemanager
    - hbase: master 和 backup
- 传统方式: 一个备用节点, 定期发送 ping 包, 主节点回复 ack, 确认存活, 不能收到就接替他成为主节点
    - 如果网络发生故障, 备用节点不能收到回复, 这样出现了两个 master, 就乱了
-  zookeeper 解决方案
    - Master启动 
在引入了Zookeeper以后我们启动了两个主节点，”主节点-A”和”主节点-B”他们启动以后，都向ZooKeeper去注册一个节点。我们 假设”主节点-A”锁注册地节点是”master-00001”，”主节点-B”注册的节点是”master-00002”，注册完以后进行选举，编号最 小的节点将在选举中获胜获得锁成为主节点，也就是我们的”主节点-A”将会获得锁成为主节点，然后”主节点-B”将被阻塞成为一个备用节点。那么，通过这 种方式就完成了对两个Master进程的调度。 
    - Master故障 
如果”主节点-A”挂了，这时候他所注册的节点将被自动删除，ZooKeeper会自动感知节点的变化，然后再次发出选举，这时候”主节点-B”将在选举中获胜，替代”主节点-A”成为主节点。 
    - Master 恢复 
如果主节点恢复了，他会再次向ZooKeeper注册一个节点，这时候他注册的节点将会是”master-00003”，ZooKeeper会感知节点的变化再次发动选举，这时候”主节点-B”在选举中会再次获胜继续担任”主节点”，”主节点-A”会担任备用节点。


- zkfc : 是一个新的组件，它是一个ZooKeeper客户端，它还监视和管理NameNode的状态。运行NameNode的每台机器也运行ZKFC，他们之间是一对一的关, 对每个 namenode进行健康监测, 故障自动转移
- zookeeper: 
    - 选举 hbase 中的 master, 当存在多个 backup 的时候, 
    - 分布式协调服务
    - hadoop(文件上传 下载 管理 更改), yarn(mapreduce 计算资源管理)的高可用性HA
    - kafka 消息分发
